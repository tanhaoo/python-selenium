import requests
import json
import os
from subprocess import check_call, CalledProcessError

# 请求的URL
url = "https://dev.azure.com/henkeldx/9a842c7b-b1f0-4c04-8a6d-1c4777c58893/_apis/git/Repositories"
# 认证的token
token = "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyIsImtpZCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyJ9.eyJhdWQiOiI0OTliODRhYy0xMzIxLTQyN2YtYWExNy0yNjdjYTY5NzU3OTgiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9lODcwMTA3NS0wZDllLTRlYTEtOTkxZC01YTBkMTEwYTVkMjkvIiwiaWF0IjoxNzM1NDg0NTAxLCJuYmYiOjE3MzU0ODQ1MDEsImV4cCI6MTczNTQ4OTM1NywiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhZQUFBQU0xbWcyckRYc2NoQjVibUhSMXJIK2Z0WGdZYzJPZFFMOFhtZ1hpZXI5a0pMR3RpVDUvL3RCVTd1bXRnZndvRXJsN0IvUStrU1FWazJESlBVdTljMTVvR1lWOU1WbTVTckFLbkFrR0UvczVJPSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwaWQiOiI0OTliODRhYy0xMzIxLTQyN2YtYWExNy0yNjdjYTY5NzU3OTgiLCJhcHBpZGFjciI6IjAiLCJhdXRoX3RpbWUiOjE3MzU0ODQ3NzQsImZhbWlseV9uYW1lIjoiVGFuIiwiZ2l2ZW5fbmFtZSI6IkFhcm9uIEhhbyIsImlkdHlwIjoidXNlciIsImlwYWRkciI6IjEwMS4yMjQuNTguMTU0IiwibmFtZSI6IkFhcm9uIEEgVGFuIiwib2lkIjoiNDA1NzMwZWUtNzhjMy00YTJiLWFiMjQtZDc3ZjA2ZjNiYTkyIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTE0MTcwMDEzMzMtMTkzNTY1NTY5Ny04NTQyNDUzOTgtMTY1NTIxMyIsInB1aWQiOiIxMDAzMjAwM0IwNjFBOThFIiwicmgiOiIxLkFSRUFkUkJ3Nko0Tm9VNlpIVm9ORVFwZEtheUVtMGtoRTM5Q3FoY21mS2FYVjVnUkFBOFJBQS4iLCJzY3AiOiJDcm9zc1RlbmFudEluZm9ybWF0aW9uLlJlYWRCYXNpYy5BbGwgVXNlci5JbnZpdGUuQWxsIFVzZXIuUmVhZCB1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJJMUF2eEQxT29Jd1BvdTV1cDFnSHNqX0ZfNkdDY3l2NzFrODdtWGNvZXRZIiwidGlkIjoiZTg3MDEwNzUtMGQ5ZS00ZWExLTk5MWQtNWEwZDExMGE1ZDI5IiwidW5pcXVlX25hbWUiOiJhYXJvbi5aLnRhbkBoZW5rZWwuY29tIiwidXBuIjoiYWFyb24uYS50YW5AaGVua2VsLmNvbSIsInV0aSI6IjN4eDZmMGJwWTAtc3loR0NDNzhFQUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbImI3OWZiZjRkLTNlZjktNDY4OS04MTQzLTc2YjE5NGU4NTUwOSJdLCJ4bXNfZnRkIjoiYlV3UDJCRGF5MzlqeTN5Y28tVWotR0RhdjduVjNGOGIyZFJJdEhzU05OVSIsInhtc19pZHJlbCI6IjEgNCJ9.h-YbUMzrwRf6Kqfi5yksHohUATHWNzfp5Kn7L1xvfgcFrBEb8yKEPm7vPOhvkLUAUsLYPHRStVkXVQ3acn8mPKLeWrgUFchxRI9ZcacC6hMXmJ7ht02GNXKTkJ6_p0K3l7L5Gr5Pmg9S7qpJOpkb5dbqqHLxkHdClthOfb9_Xe6CX3Lsx_TZJfUUIqmXRwoJpVvMOExdBvuqCu0rAo1_xym5lBBTteSHHDqTNXXksU0zhWLn54mvYet1ifMUFm8acG0u4xuAc0y9iZ0vWbOVStsurLzLBKbsvEL1Ru2j-6v2kHzQzHpG7t8ViTL312wFyde5Su7OqOVM1oQ0YQry5Q"
cookie = 'VstsSession=%7B%22PersistentSessionId%22%3A%224aa056f7-d3e4-48e3-8f8b-b849553ba5f1%22%2C%22PendingAuthenticationSessionId%22%3A%2200000000-0000-0000-0000-000000000000%22%2C%22CurrentAuthenticationSessionId%22%3A%2200000000-0000-0000-0000-000000000000%22%2C%22SignInState%22%3A%7B%7D%7D; __RequestVerificationToken=70fq-M6UrarSSqBGF52ieEu1HCxIY-aLFBw-8tWAFbFG505q6C5AxLuwZZU6aNOsxqXPSYXfn-rGaTBxE53zmXvUomxGT7CpjQcd_AQ67Ks1; __RequestVerificationToken23efc90f0-f999-4f70-8bcc-44d898d7b14b=70fq-M6UrarSSqBGF52ieEu1HCxIY-aLFBw-8tWAFbFG505q6C5AxLuwZZU6aNOsxqXPSYXfn-rGaTBxE53zmXvUomxGT7CpjQcd_AQ67Ks1; MicrosoftApplicationsTelemetryDeviceId=ea11a74c-2fb2-4e4c-a5e2-8242a5877fab; MSFPC=GUID=48cbafdc096d455c81da155645120e6a&HASH=48cb&LV=202412&V=4&LU=1734598480424; UserAuthentication=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IlZhd2dFM0I2cFotWk1vWWVCRXU0bHNoZDJSYyJ9.eyJmYW1pbHlfbmFtZSI6IlRhbiIsImdpdmVuX25hbWUiOiJBYXJvbiBIYW8iLCJvaWQiOiI0MDU3MzBlZS03OGMzLTRhMmItYWIyNC1kNzdmMDZmM2JhOTIiLCJ0aWQiOiJlODcwMTA3NS0wZDllLTRlYTEtOTkxZC01YTBkMTEwYTVkMjkiLCJzdWIiOiJlODcwMTA3NS0wZDllLTRlYTEtOTkxZC01YTBkMTEwYTVkMjlcXGFhcm9uLmEudGFuQGhlbmtlbC5jb20iLCJ1bmlxdWVfbmFtZSI6ImFhcm9uLmEudGFuQGhlbmtlbC5jb20iLCJwdWlkIjoiYWFkOjEwMDMyMDAzQjA2MUE5OEUiLCJlbWFpbCI6ImFhcm9uLmEudGFuQGhlbmtlbC5jb20iLCJ2ZXIiOiIxLjAiLCJqdGkiOiJiMDBmZTA3YS0zMDFmLTQ3NTktODk0Ny00ZDQ0ZjgwOTY4ZjEiLCJpc3MiOiJhcHAudnN0b2tlbi52aXN1YWxzdHVkaW8uY29tIiwiYXVkIjoiZTVjODY2NzYtZDA2My00ZGEzLWJiOTYtYzhlMDUwNGJkYmE1IiwibmJmIjoxNzM1NDg0Nzc3LCJleHAiOjE3MzYwODk1Nzd9.IsIrhI_GE-eFcJ857NAMrNoGSO4pR50vZyo54Dw-jKwhKhRkxehjtTq8-6c2iJxr6eCKmpHBq5cqZaudLP2LxqW_pWic2joTPbkrILMT2xGwkFCZxJbqPcN5fqViYKymSx5IsM-UqPBtNzx8T_IPVzTvZ9B8OxXwPPIM6EEwezg4zxuTbMMV37s8oxktqLM1nFxYRp34JGtSiAzzJKlGlyNhWku9jzJUa0S2eaiwpqf1uc5chjw2ZdFY3B0Kq04GCUpBiA3SZ9ygguffsEfJvh72TzyzHlVSvU0IXWLOwTtijiF607QN8iKrFE9dTdDGF9jiZw6aaY-dd-Oz1t92Nw; HostAuthentication=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Im9PdmN6NU1fN3AtSGpJS2xGWHo5M3VfVjBabyJ9.eyJuYW1laWQiOiJIb3N0QXV0aGVudGljYXRpb24iLCJob3N0X2F1dGgiOiJ7XCJzdWJzXCI6W1wiYWFkLk16Qmlaakl4TURJdE5qTmxZaTAzTXpaaUxUZzJZekF0TURJNE9EVmxOamszWWprNVwiXSxcImhvc3RzXCI6e1wiYjA4MGM5ZDktNTI2YS00M2M3LWI2ODktZmNlMmQ4YzdkMmRiXCI6e1wic3ViXCI6MH19fSIsImlzcyI6ImFwcC52c3Rva2VuLnZpc3VhbHN0dWRpby5jb20iLCJhdWQiOiJhcHAudnN0b2tlbi52aXN1YWxzdHVkaW8uY29tIiwibmJmIjoxNzM1NDg0Nzc4LCJleHAiOjE3MzU1MTM1Nzh9.127kafS23eb21jN6liW-zgNH10eJMvq66B_5hb1pKBlyxXrMIzxoNu7ZI4a8sTQWpdoorjjWHpum2SRxp4KoeKGwFVoEGMcDoMmASBd0NTEeY8xHa9TsUa4ChW72Ww3KRNVUdL2H1wq7ivFu0mG7IgI00quKEXlBLxrVGHiy_Y2aljJsVjwMcn8tX79V7hemLUhgaIzq-c_0B2p8G_EZG8eTlzeFyjfl8UBVQ3NHGneat2ecJKMBARinCRNXC3vZJh1VC8rqqRfyyjgweTErjk9JLLHRocpGOMcC_FqWHK8DovMY-eFXPhR1eJqXaXxZGJfI9MHtBo62jX9Yyc_mdQ; AadAuthenticationSet=true; AadAuthentication=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyIsImtpZCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyJ9.eyJhdWQiOiI0OTliODRhYy0xMzIxLTQyN2YtYWExNy0yNjdjYTY5NzU3OTgiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9lODcwMTA3NS0wZDllLTRlYTEtOTkxZC01YTBkMTEwYTVkMjkvIiwiaWF0IjoxNzM1NDg0NTAxLCJuYmYiOjE3MzU0ODQ1MDEsImV4cCI6MTczNTQ4OTM1NywiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhZQUFBQU0xbWcyckRYc2NoQjVibUhSMXJIK2Z0WGdZYzJPZFFMOFhtZ1hpZXI5a0pMR3RpVDUvL3RCVTd1bXRnZndvRXJsN0IvUStrU1FWazJESlBVdTljMTVvR1lWOU1WbTVTckFLbkFrR0UvczVJPSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwaWQiOiI0OTliODRhYy0xMzIxLTQyN2YtYWExNy0yNjdjYTY5NzU3OTgiLCJhcHBpZGFjciI6IjAiLCJhdXRoX3RpbWUiOjE3MzU0ODQ3NzQsImZhbWlseV9uYW1lIjoiVGFuIiwiZ2l2ZW5fbmFtZSI6IkFhcm9uIEhhbyIsImlkdHlwIjoidXNlciIsImlwYWRkciI6IjEwMS4yMjQuNTguMTU0IiwibmFtZSI6IkFhcm9uIEEgVGFuIiwib2lkIjoiNDA1NzMwZWUtNzhjMy00YTJiLWFiMjQtZDc3ZjA2ZjNiYTkyIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTE0MTcwMDEzMzMtMTkzNTY1NTY5Ny04NTQyNDUzOTgtMTY1NTIxMyIsInB1aWQiOiIxMDAzMjAwM0IwNjFBOThFIiwicmgiOiIxLkFSRUFkUkJ3Nko0Tm9VNlpIVm9ORVFwZEtheUVtMGtoRTM5Q3FoY21mS2FYVjVnUkFBOFJBQS4iLCJzY3AiOiJDcm9zc1RlbmFudEluZm9ybWF0aW9uLlJlYWRCYXNpYy5BbGwgVXNlci5JbnZpdGUuQWxsIFVzZXIuUmVhZCB1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJJMUF2eEQxT29Jd1BvdTV1cDFnSHNqX0ZfNkdDY3l2NzFrODdtWGNvZXRZIiwidGlkIjoiZTg3MDEwNzUtMGQ5ZS00ZWExLTk5MWQtNWEwZDExMGE1ZDI5IiwidW5pcXVlX25hbWUiOiJhYXJvbi5hLnRhbkBoZW5rZWwuY29tIiwidXBuIjoiYWFyb24uYS50YW5AaGVua2VsLmNvbSIsInV0aSI6IjN4eDZmMGJwWTAtc3loR0NDNzhFQUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbImI3OWZiZjRkLTNlZjktNDY4OS04MTQzLTc2YjE5NGU4NTUwOSJdLCJ4bXNfZnRkIjoiYlV3UDJCRGF5MzlqeTN5Y28tVWotR0RhdjduVjNGOGIyZFJJdEhzU05OVSIsInhtc19pZHJlbCI6IjEgNCJ9.h-YbUMzrwRf6Kqfi5yksHohUATHWNzfp5Kn7L1xvfgcFrBEb8yKEPm7vPOhvkLUAUsLYPHRStVkXVQ3acn8mPKLeWrgUFchxRI9ZcacC6hMXmJ7ht02GNXKTkJ6_p0K3l7L5Gr5Pmg9S7qpJOpkb5dbqqHLxkHdClthOfb9_Xe6CX3Lsx_TZJfUUIqmXRwoJpVvMOExdBvuqCu0rAo1_xym5lBBTteSHHDqTNXXksU0zhWLn54mvYet1ifMUFm8acG0u4xuAc0y9iZ0vWbOVStsurLzLBKbsvEL1Ru2j-6v2kHzQzHpG7t8ViTL312wFyde5Su7OqOVM1oQ0YQry5Q; ai_session=lFsNTteNeb6lBGK6zcWCow|1735484804230|1735484872969'

# 设置请求头，添加认证信息
headers = {
    "Authorization": token,
    "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36",
    "Cookie": cookie
}

script_path = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
dir_repos = "henkel_repository"


def repo_dir():
    return os.path.join(script_path, dir_repos)


def doShell(shell, path):
    try:
        check_call(shell, cwd=path, shell=True)
    except CalledProcessError as e:
        print("Error:", e)


def download(result):
    for url in result:
        print(repo_dir())
        doShell('git clone ' + url, repo_dir())


if __name__ == "__main__":
    try:
        # 发送GET请求，你可以根据实际情况调整请求方法（如POST等）
        response = requests.get(url, headers=headers)
        # 如果响应状态码是200，说明请求成功
        if response.status_code == 200:
            result_list = []
            # 解析JSON格式的响应体
            data = json.loads(response.text)
            # 假设data是一个列表，里面包含多个字典，遍历每个字典获取sshUrl字段值
            for item in data["value"]:
                result_list.append(item["sshUrl"])
            print(result_list)
            download(result_list)
        else:
            print(f"请求失败，状态码: {response.status_code}")
    except requests.RequestException as e:
        print(f"请求出现异常: {e}")
